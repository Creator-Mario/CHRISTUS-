<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta name="theme-color" content="#f0c050">
    <title>CHRISTUS v1.17.16</title>
    <link rel="manifest" href="app/manifest.json">
    <style>
        body{font-family:'Segoe UI',system-ui,Arial,sans-serif;background:#0f1028;color:#ede8ff;
             display:flex;align-items:center;justify-content:center;min-height:100vh;margin:0}
        .splash{text-align:center;padding:40px 20px}
        .logo{font-size:64px;color:#f0c050;margin-bottom:12px}
        .name{font-size:2rem;font-weight:700;letter-spacing:4px;color:#f0c050;margin-bottom:4px}
        .ver{font-size:.78rem;color:#9890c0;margin-bottom:32px}
        .spinner{width:32px;height:32px;border:3px solid #36387a;border-top-color:#f0c050;
                 border-radius:50%;animation:spin .8s linear infinite;margin:0 auto}
        @keyframes spin{to{transform:rotate(360deg)}}
    </style>
</head>
<body>
    <div class="splash">
        <div class="logo">&#10013;</div>
        <div class="name">CHRISTUS</div>
        <div class="ver">Version 1.17.16 &bull; Glaubensbildung &amp; Nachfolge</div>
        <div class="spinner"></div>
    </div>
    <script>
        // Register Service Worker for offline support
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./sw.js')
              .catch(err => console.warn('SW registration failed:', err));

            // When SW controller changes (new SW took over after user applied update),
            // reload to get fresh pages. The update banner on app pages triggers this.
            navigator.serviceWorker.addEventListener('controllerchange', () => {
                window.location.reload();
            });
        }
        // Route: registered user with valid session → home, everyone else → login
        const session = JSON.parse(localStorage.getItem('christus_session') || 'null');
        const valid = session && session.email && (Date.now() - session.time < 7 * 24 * 60 * 60 * 1000);
        const dest = valid ? 'app/home.html' : 'app/login.html';
        setTimeout(() => { window.location.href = dest; }, 300);
    </script>
</body>
</html>